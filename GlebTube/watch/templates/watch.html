{% extends 'index.html' %}

{% block title %} {{video.caption}} {% endblock %}

{%block content %}

{% load static %}
{% csrf_token %}

{% load user_filters %}


<!--Styles-->
<link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
<link rel="stylesheet" a href="{% static '/css/enchanced_player.css' %}"> 

<div class="container mt-5">
  <div class="card mb-3 border-0">
  
  {% include 'video/video_loading_load.html' %}
    
  </div>

<div class="post float-right" data-post-id="{{video.id}}">
<div class = "rate_container float-right"
hx-get="{% url 'rate_video' video.id %}" hx-swap="innerHTML" hx-trigger="revealed">

{% include 'spinners/loading_spinner_htmx.html' %}
</div>


<!-- COMMENT(s) -->
</div class="comment_form">
  <h3 id="comments_count"><i class="bi bi-chat-dots-fill">  Комментарии</i></h3>
  
  <div class="p-2">
    <div class="d-flex flex-row align-items-start">
        <img class="rounded-circle mx-3" src="{{user.additional.avatar | parse_avatar}}" width="50" height="50">
        <textarea class="form-control ml-1 shadow-none textarea" id="comment" placeholder="Введите комментарий"></textarea>
    </div>
    <div class="mt-2 float-end">
        <button type="button" id="clearButton" class="btn btn-outline-primary btn-sm shadow-none"><i class="bi bi-trash"></i></button>
        <button hx-post="{% url 'add_comment' video.id %}" hx-vars="comment:document.getElementById('comment').value" 
         hx-target=".comment_list"
         hx-swap="afterbegin"
         hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
         class="btn btn-primary btn-sm shadow-none  " id="sendButton" type="button"><i class="bi bi-send"> Отправить</i></button>
    </div>
</div>
<br>
<div class="comment_list mt-4"
hx-get="{% url 'fetch_comments' video.id %}"
hx-trigger="revealed"
hx-swap="innerHTML">
{% include 'spinners/loading_spinner_htmx.html' %}
</div>
</div>
</div>

<!--Scripts-->


<script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>
<script src="{% static '/js/comment_video.js' %}"></script>
{% endblock %}